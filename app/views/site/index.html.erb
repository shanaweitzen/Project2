


<script type="text/javascript">
  $(function(){
// var redMarker = L.AwesomeMarkers.icon({
//   icon: 'spinner', 
//   color: 'red',
//   spin: true
// })
 	var map = L.map('map').setView([51.505, -0.09], 3);

 	var redMarker = L.icon({
   		icon: 'flag', 
		color: 'red',
	    iconSize: [34, 40], 
		iconUrl : 'http://icon-park.com/imagefiles/location_map_pin_attention_light_blue.png'
 	})
 	
 	var blueMarker = L.icon({
 		icon: 'flag', 
		color: 'blue',
	    iconSize: [33, 45], 
		iconUrl : 'http://icon-park.com/imagefiles/location_map_pin_red3.png'
		 	})
 	
 	L.tileLayer('http://a.tile.cloudmade.com/6bb82f6e0733473698298dc3a8287ee0/7/256/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

 	<% @data_points = DataPoint.all %>
	<% @data_points.each do |dp| %>
	  	<% @country_code = dp.alpha_2_code %>
	  	<% @country = Country.find_by(alpha_2_code: @country_code) %> 
	  	<% if @country %>
		  	<% @lat = @country.latitude_average %>
		  	<% @lng = @country.longitude_average %>
		 <% @level = dp.level %>
		  	<% if @level == 'alert' %>
				console.log("<%= @level %>")
				 
				 L.marker([<%= @lat %>, <%= @lng %>],{ icon: redMarker}).addTo(map);
			<% else %>
				console.log("<%= @level %>")
				 L.marker([<%= @lat %>, <%= @lng %>],{ icon: blueMarker}).addTo(map);
				// L.marker([<%= @lat %>, <%= @lng %>]).addTo(map);
			<% end %>
		    // L.marker([<%= @lat %>, <%= @lng %>],<%= @level %>).addTo(map);
	    <% end %>
	<% end %>

});

</script>

<div id="map"></div>